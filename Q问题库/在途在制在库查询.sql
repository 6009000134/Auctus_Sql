 --冻结BOM
 DECLARE @Date DATE=CONVERT(DATE,GETDATE())
 IF object_id('tempdb.dbo.#TempTable') is NULL
 CREATE TABLE #TempTable (StrID VARCHAR(20))
 ELSE
 TRUNCATE TABLE #TempTable
INSERT INTO #TempTable SELECT strid FROM dbo.fun_Cust_StrToTable2('301010061,301010064,301010069,301010076,302010049,302010110,304010031,306010681,306010820,306010875,306010960,306011015,306011052,306011060,306011061,307010336,307010377,307010413,307010417,307011783,307011825,308010071,308010073,308010130,308010146,308010149,308010160,308010169,308010185,308010224,308010226,308010227,308010230,308010232,308010660,308010747,308010800,309010436,309010456,309010459,309030044,309050190,309050191,309050192,309050193,309050194,310010017,310010145,311020018,312020077,312020097,312020126,313010007,313010089,313030057,314010016,314020009,314020057,314020131,314020143,314020212,314040049,314080006,314210244,314210280,314210281,315010005,315010072,319010005,319010059,319020001,319050002,319050013,319100009,319100168,319100228,319100230,319130004,319130047,320010024,321010046,326010041,327010008,329010244,329070008,331010038,331010048,331010049,331030004,332010031,332020102,332040031,332050117,332050162,332090018,332100065,332120001,332140005,333010001,333010184,333010193,333010326,333020172,333020191,333030048,333030056,333040031,333050015,333060209,333090007,333090092,333100163,333100168,333110005,333120035,333170009,333170058,333170090,334030028,334030059,335010004,335010010,335030268,335040008,335060005,335060192,335060258,335060318,335060381,335060404,335060466,335070053,335070057,335100420,335100428,335100491,336040062,336040063',',') 
INNER JOIN dbo.CBO_ItemMaster m ON m.Org=(SELECT id FROM dbo.Base_Organization WHERE code='100') 
--AND m.Effective_IsEffective=0 
AND strID=m.Code
SELECT *FROM #TempTable
--库存
SELECT OrgCode 组织,OrgName 组织名称,Wh_Name 存储地点,StorageType 存储类型,Code 料号,Name 品名,SPECS 规格,BalQty 库存 FROM dbo.v_Cust_InvInfo4OA
WHERE Code IN(
SELECT strid FROM #TempTable
)
AND BalQty>0
--在制
SELECT DocNo 单号,PickLineNo 行号,NULL 创建人,NULL 创建时间,'300' 组织,Code 料号,'备料' 类型 FROM dbo.Auctus_FullSetCheckResult8 
WHERE  CopyDate>@Date AND  Code IN
(
SELECT strid FROM #TempTable
)
UNION ALL 
SELECT DocNo,0,NULL 创建人,null,'300' Org,ProductCode,'生产订单' FROM dbo.Auctus_FullSetCheckResult8 
WHERE  CopyDate>@Date AND  ProductCode IN
(
SELECT strid FROM #TempTable
)
UNION ALL 
--在途
SELECT a.DocNo,b.DocLineNo,a.CreatedBy,a.CreatedOn,o.Code OrgCode,m.Code,'采购订单' FROM dbo.PM_PurchaseOrder a INNER JOIN dbo.PM_POLine b ON a.ID=b.PurchaseOrder
INNER JOIN dbo.CBO_ItemMaster m ON b.ItemInfo_ItemID=m.ID
INNER JOIN dbo.Base_Organization o ON a.Org=o.ID
WHERE a.Cancel_Canceled=0 AND b.Status NOT IN (3,4,5)
AND m.Code IN (
SELECT strid FROM #TempTable
)
UNION ALL 
SELECT a.DocNo,b.DocLineNo,a.CreatedBy,a.CreatedOn,o.Code OrgCode,m.Code,'请购单' 
FROM dbo.PR_PR a INNER JOIN dbo.PR_PRLine b ON a.ID=b.PR
INNER JOIN dbo.CBO_ItemMaster m ON b.ItemInfo_ItemID=m.ID
INNER JOIN dbo.Base_Organization o ON a.Org=o.ID
WHERE a.Cancel_Canceled=0 AND b.Status IN (0,1,2)
AND m.Code IN (
SELECT strid FROM #TempTable
)
UNION all
SELECT a.DocNo,b.DocLineNo,a.CreatedBy,a.CreatedOn,o.code,m.Code,'销售订单' FROM dbo.SM_SO a INNER JOIN dbo.SM_SOLine b ON a.ID=b.SO
INNER JOIN dbo.CBO_ItemMaster m ON b.ItemInfo_ItemID=m.ID
INNER JOIN dbo.Base_Organization o ON a.Org=o.ID
WHERE a.Cancel_Canceled=0 AND b.Status NOT IN (4,5,6)
AND m.Code IN (
SELECT strid FROM #TempTable
)
